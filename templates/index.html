<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –°–º–µ—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: var(--tg-theme-bg-color, #f3f4f6);
            color: var(--tg-theme-text-color, #000);
            padding-bottom: 80px; /* –ú–µ—Å—Ç–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
        }
        .card {
            background-color: var(--tg-theme-secondary-bg-color, #fff);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .btn-add {
            color: var(--tg-theme-button-color, #3b82f6);
        }
        input, select {
            background-color: var(--tg-theme-bg-color, #f9fafb);
            color: var(--tg-theme-text-color, #000);
        }
    </style>
</head>
<body class="p-3 max-w-md mx-auto">

    <h1 class="text-xl font-bold mb-4 text-center">üë∑‚Äç‚ôÇÔ∏è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–º–µ—Ç—ã</h1>

    <form id="orderForm" class="space-y-3">

        <!-- 1. –û–°–ù–û–í–ù–û–ï -->
        <div class="card p-4 rounded-xl">
            <h3 class="font-bold text-sm text-gray-500 mb-2 uppercase">–ö–ª–∏–µ–Ω—Ç</h3>

            <div class="space-y-3">
                <div>
                    <label class="text-xs ml-1">–ò–º—è</label>
                    <input type="text" id="client_name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" class="w-full p-3 rounded-lg border border-gray-200 focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-xs ml-1">–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
                    <input type="text" id="address" placeholder="–°–ù–¢ –†–æ–º–∞—à–∫–∞, —É—á. 45" class="w-full p-3 rounded-lg border border-gray-200 focus:outline-none focus:border-blue-500">
                </div>
            </div>
        </div>

        <!-- 2. –¢–ï–•–ù–ò–ö–ê -->
        <div class="card p-4 rounded-xl">
            <h3 class="font-bold text-sm text-gray-500 mb-2 uppercase">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h3>

            <label class="text-xs ml-1">–ú–æ–¥–µ–ª—å —Å–µ–ø—Ç–∏–∫–∞</label>
            <select id="product_id" class="w-full p-3 mb-3 rounded-lg border border-gray-200 bg-white">
                <option value="tver_08">–¢–≤–µ—Ä—å 0.8 (–¥–æ 5 —á–µ–ª)</option>
                <option value="tver_11">–¢–≤–µ—Ä—å 1.1 (–¥–æ 7 —á–µ–ª)</option>
            </select>

            <label class="text-xs ml-1">–¢–∏–ø –≥—Ä—É–Ω—Ç–∞</label>
            <div class="flex bg-gray-100 p-1 rounded-lg mb-4">
                <label class="flex-1 text-center cursor-pointer">
                    <input type="radio" name="soil" value="sand" checked class="hidden peer">
                    <div class="py-2 rounded-md peer-checked:bg-white peer-checked:shadow-sm peer-checked:text-blue-600 transition">–ü–µ—Å–æ–∫</div>
                </label>
                <label class="flex-1 text-center cursor-pointer">
                    <input type="radio" name="soil" value="clay" class="hidden peer">
                    <div class="py-2 rounded-md peer-checked:bg-white peer-checked:shadow-sm peer-checked:text-blue-600 transition">–ì–ª–∏–Ω–∞</div>
                </label>
            </div>

            <label class="text-xs ml-1">–î–ª–∏–Ω–∞ —Ç—Ä–∞—Å—Å—ã (–º)</label>
            <div class="flex items-center gap-2">
                <button type="button" onclick="adjPipe(-1)" class="w-10 h-10 bg-gray-200 rounded-lg font-bold text-xl">-</button>
                <input type="number" id="pipe_length" value="5" class="flex-1 text-center p-2 text-lg font-bold bg-transparent border-b">
                <button type="button" onclick="adjPipe(1)" class="w-10 h-10 bg-gray-200 rounded-lg font-bold text-xl">+</button>
            </div>
        </div>

        <!-- 3. –î–û–ü. –£–°–õ–£–ì–ò (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –°–ü–ò–°–û–ö) -->
        <div class="card p-4 rounded-xl">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-bold text-sm text-gray-500 uppercase">–î–æ–ø. —Ä–∞–±–æ—Ç—ã</h3>
                <button type="button" onclick="addCustomItem()" class="text-sm font-bold text-blue-600 hover:text-blue-800">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç—Ä–æ–∫ -->
            <div id="custom-items-container" class="space-y-2">
                <!-- –°—é–¥–∞ JS –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è -->
            </div>

            <!-- –ß–µ–∫–±–æ–∫—Å –ë—É—Ä–µ–Ω–∏—è (–∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–ø—Ü–∏—è) -->
            <label class="flex items-center justify-between p-3 mt-2 bg-gray-50 rounded-lg border border-gray-100 cursor-pointer">
                <span class="font-medium">üõ† –ê–ª–º–∞–∑–Ω–æ–µ –±—É—Ä–µ–Ω–∏–µ</span>
                <input type="checkbox" id="diamond_drilling" class="w-5 h-5 text-blue-600 rounded">
            </label>
        </div>

    </form>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¢–µ–ª–µ–≥—Ä–∞–º–∞
    tg.MainButton.setText("–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –°–ú–ï–¢–£");
    tg.MainButton.show();

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä—É–±–æ–π
    function adjPipe(delta) {
        const el = document.getElementById('pipe_length');
        let val = parseInt(el.value) + delta;
        if (val < 0) val = 0;
        el.value = val;
    }

    // --- –õ–û–ì–ò–ö–ê –î–û–ü. –£–°–õ–£–ì ---

    function addCustomItem() {
        const container = document.getElementById('custom-items-container');
        const id = Date.now(); // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

        const html = `
        <div id="item-${id}" class="flex gap-2 items-center animate-fade-in">
            <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –í—ã–≤–æ–∑ –≥—Ä—É–Ω—Ç–∞)" class="custom-name flex-[2] p-2 text-sm border rounded-lg">
            <input type="number" placeholder="–¶–µ–Ω–∞" class="custom-price flex-1 p-2 text-sm border rounded-lg">
            <button type="button" onclick="removeCustomItem(${id})" class="text-red-500 font-bold px-2">‚úï</button>
        </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    }

    function removeCustomItem(id) {
        document.getElementById(`item-${id}`).remove();
    }

    // --- –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• ---
    Telegram.WebApp.onEvent('mainButtonClicked', function(){
        // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const data = {
            client_name: document.getElementById('client_name').value || "–ó–∞–∫–∞–∑—á–∏–∫",
            address: document.getElementById('address').value || "–ù–µ —É–∫–∞–∑–∞–Ω",
            product_id: document.getElementById('product_id').value,
            soil: document.querySelector('input[name="soil"]:checked').value,
            pipe_length: parseInt(document.getElementById('pipe_length').value),
            diamond_drilling: document.getElementById('diamond_drilling').checked,
            custom_items: []
        };

        // –°–æ–±–∏—Ä–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —É—Å–ª—É–≥–∏
        const names = document.querySelectorAll('.custom-name');
        const prices = document.querySelectorAll('.custom-price');

        names.forEach((nameInput, index) => {
            const name = nameInput.value.trim();
            const price = parseInt(prices[index].value) || 0;

            if (name) {
                data.custom_items.push({
                    name: name,
                    price: price,
                    qty: 1 // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —à—Ç
                });
            }
        });

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º JSON –±–æ—Ç—É
        tg.sendData(JSON.stringify(data));
    });
</script>

<style>
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fade-in 0.2s ease-out;
    }
</style>
</body>
</html>